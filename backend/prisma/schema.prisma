// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Client {
  id              String          @id @default(uuid())
  name            String
  phone           String?
  credit          Float           @default(0)
  totalDebt       Float           @default(0)
  lastInteraction DateTime        @default(now())
  sales           Sale[]
  payments        PaymentRecord[]
}

model Product {
  id          String  @id @default(uuid())
  name        String
  department  String  @default("Geral") // New: Pet Shop, Agro, etc
  subCategory String  @default("Outros") // New: Secondary level
  category    String? // Leagcy/Optional
  animalType  String? // Legacy/Optional
  price       Float
  cost        Float?
  unit        String
  stock       Float?  @default(0)
  trackStock  Boolean @default(false)
}

model Sale {
  id                   String   @id @default(uuid())
  clientId             String?
  client               Client?  @relation(fields: [clientId], references: [id])
  clientName           String?  // Snapshot do nome
  type                 String   // 'CASH' | 'CREDIT'
  subtotal             Float
  discountOrAdjustment Float    @default(0)
  finalTotal           Float
  remainingBalance     Float
  timestamp            DateTime @default(now())
  status               String   // 'PAID' | 'PENDING' | 'PARTIAL'
  items                SaleItem[]
}

model SaleItem {
  id          String @id @default(uuid())
  saleId      String
  sale        Sale   @relation(fields: [saleId], references: [id], onDelete: Cascade)
  productId   String
  productName String
  quantity    Float
  unitPrice   Float
  total       Float
}

model PaymentRecord {
  id         String   @id @default(uuid())
  clientId   String
  client     Client   @relation(fields: [clientId], references: [id])
  amount     Float
  timestamp  DateTime @default(now())
  usedCredit Boolean
}

model Expense {
  id          String   @id @default(uuid())
  description String
  amount      Float
  category    String   // 'FIXED' | 'VARIABLE'
  date        DateTime
}
